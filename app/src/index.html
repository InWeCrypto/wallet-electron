<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- <META HTTP-EQUIV="pragma" CONTENT="no-cache">
    <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
    <META HTTP-EQUIV="expires" CONTENT="0"> -->
    <title>InWeWallet</title>
</head>

<body>
    <div style="-webkit-app-region: drag;position: fixed;top: 0;left: 0;width: 100%;height: .2rem;z-index:100000;pointer-events:none;"></div>
    <div id="root"></div>

    <script>
        var electron = window.require("electron");
        var os = window.require('os');
        var fs = window.require('fs');
        var path = window.require('path')
        var cp = window.require("child_process");
        window.log4js = window.require('log4js');
        let el = document.getElementById('root');
        log4js.configure({
            appenders: { cheese: { type: 'file', filename: path.join(os.tmpdir(), 'inwewallet/debug/cheese.log') } },
            categories: { default: { appenders: ['cheese'], level: 'info' } }
        });
        const logger = log4js.getLogger('cheese');
        var webFrame = window.webFrame = electron.webFrame
        var ipc = window.ipc = electron.ipcRenderer;
        var shell = window.shell = electron.shell;
        var EWin = window.EWin = electron.remote.getCurrentWindow();
        var dialog = window.dialog = electron.remote.dialog;
        var clipboard = window.clipboard = electron.clipboard;
        var app = window.app = electron.remote.app;

        ipc.on('checkUpdate', function (event, res) {
            if (!res) {
                sessionStorage.setItem('hasUpdate', false)
            } else {
                sessionStorage.setItem('hasUpdate', JSON.stringify(res))
            }
        })

        ipc.on('downUpdate', function (event, ev) {
            console.log(ev)
        })
        ipc.on('changeNetwork', function (event, type) {
            let network = localStorage.getItem('isDev')
            if (type == 'test' && (!network || !JSON.parse(network))) {
                localStorage.setItem('isDev', true);
                toHref('/');
            }
            if (type == 'formal' && network && JSON.parse(network)) {
                localStorage.setItem('isDev', false);
                toHref('/');
            }
        });
        ipc.send('clear', function () {
            webFrame.clearCache();
        })
        ipc.on('changeUser', function () {
            localStorage.removeItem('userInfo');
            toHref('/')
        })
        ipc.on('changeLng', function (event, type) {
            let lng = getLocalItem('language');
            if (lng && lng.data != type) {
                setLocalItem('language', type);
                window.location.reload();
            }
        })
        ipc.on('loadHistory', function (event, list) {
            if (list && list instanceof Array && list.length > 0) {
                list.map(function (item, index) {
                    window.history.pushState(``, '', `file://${item.pathname}${item.hash}${item.search.length > 0 ? '?' + item.search : ''}`);
                })
                var l = list.length;
                window.my.history.replace({
                    path: list[l - 1].hash.replace('#/', '') + 'test',
                    search: list[l - 1].search
                });
                setTimeout(() => {
                    window.my.history.replace({
                        path: list[l - 1].hash.replace('#/', ''),
                        search: list[l - 1].search
                    });
                }, 200)
            }
        })
        window.onhashchange = function () {
            if (window.location.href.indexOf('print') == -1) {
                var h = window.location;
                var h1 = '';
                var h2 = '';
                if (h.hash.indexOf('?') != -1) {
                    var ha = h.hash.split('?');
                    h1 = ha[0];
                    h2 = ha[1]
                } else {
                    h1 = h.hash
                }

                var o = {
                    hash: h1,
                    search: h2,
                    pathname: h.pathname
                }
                ipc.send('pageHistory', o)
                window.localStorage.setItem('lastPage', o)
            }
        }
        let network = localStorage.getItem('isDev')
        if (!network || !JSON.parse(network)) {
            ipc.send('loadNetwok', 'formal');
        } else {
            ipc.send('loadNetwok', 'test');
        }

    </script>
    <script type="text/javascript" src="./mainfest/vendor.dll.js "></script>
</body>

</html>